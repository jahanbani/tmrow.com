<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#" lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="We want to propel humanity to a sustainable state of existence by quantifying, and making widely accessible, the impact of every choice we make" />
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="img/favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta property="og:description" content="We want to propel humanity to a sustainable state of existence by quantifying, and making widely accessible, the impact of every choice we make" />
    <meta property="og:url" content="http://www.tmrow.co" />
    <meta property="og:image" content="http://www.tmrow.co/img/tmrow-social.jpg" />
    <meta property="og:title" content="Tomorrow - Quantifying the impact of every choice we make" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="We want to propel humanity to a sustainable state of existence by quantifying, and making widely accessible, the impact of every choice we make" />
    <meta name="twitter:image" content="http://www.tmrow.co/img/tmrow-social.jpg">
    <meta name="twitter:site" content="@tmrowco">
    <meta name="twitter:title" content="Tomorrow - Quantifying the impact of every choice we make" />
    <link rel="apple-touch-icon" sizes="57x57" href="img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/manifest.json">
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:300i,400" rel="stylesheet">
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">    
    <!--[if lt IE 9]>
      <script src="bower_components/html5shiv/dist/html5shiv.js"></script>
    <![endif]-->
    <title>Tomorrow -- Live FR CO2 impact</title>
    <!-- start Mixpanel -->
    <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
    for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
    mixpanel.init("62254a092953432d14177a334646064c");</script>
  <!-- end Mixpanel -->
  <!-- start GA -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-79729918-2', 'auto');
  </script>
  <!-- end GA -->
  </head>
  <body>
    <!-- start Twitter -->
    <script>
        window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function(f) {
            t._e.push(f);
        };

        return t;
        }(document, "script", "twitter-wjs"));
    </script>
    <!-- end Twitter -->
    <!-- Load Facebook SDK for JavaScript -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <header id="main-header">
      <div id="header-content">
        <a href="index.html" title="Tomorrow">
          <img class="svg logo" src="img/logo_with_tagline.svg"/>
          <img class="svg logo mobile" src="img/logo_with_tagline_stacked.svg"/>
        </a>
        <ul class="menu">
          <li class="email"><a href="mailto:hello@tmrow.co"><i class="fa fa-envelope" aria-hidden="true"></i> Contact</a></li>
          <li class="blog"><a href="https://medium.com/tmrow" target="_blank"><i class="fa fa-medium" aria-hidden="true"></i> Blog</a></li>
          <li class="projects"><a href="projects"><i class="fa fa-flask" aria-hidden="true"></i> Projects</a></li>
          <li class="team"><a href="team.html"><i class="fa fa-users" aria-hidden="true"></i> Team</a></li>
        </ul>
      </div>
    </header>
    <div id="main">
      <div id="main-content">
        <h2>Impact CO2 des imports d'électricité en France</h2>
        <p style="text-align: center">
          <span id="show-power" onclick="javascript:showPower();">Puissance électrique</span> | <span id="show-co2" onclick="javascript:showCO2();">Impact CO2</span>
        </p>
        <div id="graph" style="background-color: white">
          <canvas id="chart"></canvas>
        </div>
        <div>
          <p>
          <span id="current-time" style="font-weight: bold"></span>:
            <small><ul>
                <li> La France produit <strong><span id="total-production"></span> GW d'électricité</strong>, correspondant à un impact carbone de <strong><span id="total-production-emissions"></span> tonnes de CO2 par minute.</strong></li>
                <li> La France <span id="power-flow-direction-verb"></span> <strong><span id="power-flow-value"></span> GW d'électricité</strong>, <span id="co2-power-flow-contradition"></span> <span id="co2-flow-increase-verb"></span> son impact carbone de <strong><span id="co2-flow-value"></span> tonnes de CO2 par minute.</strong></li>
                <li id="explanation-line"> Ainsi, la France importe <strong><span id="import-percentage"></span>% de son électricité</strong> comptant pour <strong><span id="import-emissions-percentage"></span>% de ses émissions de CO2</strong> liées à la consommation électrique.</li>
            </ul></small>
          </p>
          <p> Toutes les données utilisées sur cette page proviennent de l'<a href="http://electricitymap.tmrow.co" target="_blank" style="color: lightblue"><strong>Electricity Map</strong></a>.
          <br />
          <br />
          <hr>
          <small>
            <h3>FAQ</h3>
            <p style="font-weight: bold">
              Q: Pourquoi est-ce que le pourcentage d'augmentation de l'impact carbone est plus important que le pourcentage d'augmentation des imports en électricité?
            </p>
            <p>
              L'intensité carbone (par unité d'énergie) de l'électricité produite en France est souvent plus basse que ses pays voisins. En important depuis ses voisins, plus intensifs en carbone, la France augmente donc son impact carbone.
            </p>
            <p style="font-weight: bold">
              Q: Peut-on exporter de l'électricité tout en ayant une impact carbone qui augmente?
            </p>
            <p>
              Bien souvent la France importe du CO2 depuis un pays (depuis l'Espagne par exemple) et en exporte vers un autre (vers l'Italie par exemple), au même moment. Lorsque la France exporte davantage d'électricité qu'elle n'en importe, elle devient "nette exportatrice". Cependant, lorsque les imports d'électricité sont beaucoup plus intensifs en carbone que la production nationale, le solde de CO2 peut être défavorable.<br />
              <br />
              Exemple chiffré: Si pendant une heure la France importe 1000 MW à 200 gCO2/kWh et exporte 1100 MW à 100gCO2/kWh, alors elle aura exporté au final 100 MWh mais aura augmenté son impact carbone de 90 tonnes de CO2.
            </p>
          </small>

          <script src="https://d3js.org/d3.v4.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
          <script>

            var handleHover;
            var chart;
            var redraw;
            var drawChart;
            var isShowingCO2 = false;

            function showCO2() {
              isShowingCO2 = true;
              drawChart();
            }

            function showPower() {
              isShowingCO2 = false;
              drawChart();
            }

            function getLast(arr) {
              return arr && arr.length && arr[arr.length - 1] || undefined;
            }

            // Load proper locale
            var locale = window.navigator.userLanguage || window.navigator.language;
            moment.locale(locale);

            d3.json('http://electricitymap.tmrow.co/v2/co2LastDay?countryCode=FR', function(err, obj) {
              console.log(obj);

              // We only work in GW here

              var productionCO2Intensity = obj.data.map(function(zone) {
                // Weighted average in g/MWh
                var Z = d3.entries(zone.production).map(function(o) {
                  return (zone.productionCo2Intensities[o.key] * 1e3) * (o.value);
                }).reduce(function(a,b) { return a + b });
                Z = Z / d3.sum(d3.values(zone.production));
                return {
                  x: moment(zone.datetime),
                  y: Z * 1e3 // in g/GWh
                }
              });
              var production = obj.data.map(function(zone) {
                return {
                  x: moment(zone.datetime),
                  y: zone.totalProduction / 1e3
                }
              });
              var productionCO2Mass = obj.data.map(function(_, i) {
                return {
                  x: production[i].x,
                  y: (production[i].y * productionCO2Intensity[i].y) / 60.0 / 1e6 // t / min
                }
              });

              var negativeExchanges = obj.data.map(function(zone) {
                // Sum all exchanges
                return {
                  x: moment(zone.datetime),
                  y: Math.min(d3.sum(d3.values(zone.exchange)), 0) / 1000.0
                }
              });
              var positiveExchanges = obj.data.map(function(zone) {
                // Sum all exchanges
                return {
                  x: moment(zone.datetime),
                  y: Math.max(d3.sum(d3.values(zone.exchange)), 0) / 1000.0
                }
              });
              var exchangesCO2Mass = obj.data.map(function(zone) {
                // Scalar product
                var value = d3.entries(zone.exchange).map(function(o) {
                  return (zone.exchangeCo2Intensities[o.key] * 1e6) * (o.value / 1e3);
                }).reduce(function(a,b) { return a + b });
                return {
                  x: moment(zone.datetime),
                  y: value / 60.0 / 1e6 // t / min
                }
              });
              var positiveExchangesCO2Mass = exchangesCO2Mass.map(function(d, i) {
                var isImportingCO2 = d.y >= 0;
                return {x: d.x, y: isImportingCO2 ? d.y : 0}
              });
              var negativeExchangesCO2Mass = exchangesCO2Mass.map(function(d, i) {
                var isImportingCO2 = d.y >= 0;
                return {x: d.x, y: (!isImportingCO2) ? d.y : 0}
              });

              handleHover = function(evt) {
                if (!evt.length) return redraw();
                var i = evt[0]._index;
                redraw(i);
              }

              redraw = function(i) {

                function get(arr) {
                  return (i === undefined) ? getLast(arr) : arr[i]
                }

                var importPercentage = get(positiveExchanges).y /
                  (get(production).y + get(positiveExchanges).y) * 100.0;
                var importCO2MassPercentage = get(positiveExchangesCO2Mass).y /
                  (get(productionCO2Mass).y + get(positiveExchangesCO2Mass).y) * 100.0;
                var isImporting = !(get(negativeExchanges).y < 0);
                var isImportingCO2 = !(get(negativeExchangesCO2Mass).y < 0);

                document.getElementById('current-time').innerHTML = 
                  moment(get(production).x).calendar();
                document.getElementById('total-production').innerHTML = 
                  d3.format('.1f')(get(production).y);
                document.getElementById('total-production-emissions').innerHTML = 
                  d3.format('.0f')(get(productionCO2Mass).y);

                document.getElementById('power-flow-direction-verb').innerHTML = 
                  isImporting ? 'importe' : 'exporte';
                document.getElementById('power-flow-value').innerHTML = 
                  d3.format('.1f')(get(positiveExchanges).y - get(negativeExchanges).y);
                document.getElementById('co2-flow-value').innerHTML = 
                  d3.format('.0f')(Math.abs(get(exchangesCO2Mass).y));
                document.getElementById('co2-flow-increase-verb').innerHTML = 
                  isImportingCO2 ? 'augmente' : 'dimine';
                document.getElementById('co2-power-flow-contradition').innerHTML =
                  (isImporting != isImportingCO2) ? 'mais' : 'et';

                document.getElementById('explanation-line').style.display = 
                  (isImporting && isImportingCO2) ? 'list-item' : 'none';

                document.getElementById('import-percentage').innerHTML = 
                  d3.format('.1f')(importPercentage);
                document.getElementById('import-emissions-percentage').innerHTML = 
                  d3.format('.1f')(importCO2MassPercentage);
              }

              redraw();

              var powerDataset = [
                {
                  label: 'Exportation',
                  data: negativeExchanges,
                  backgroundColor: '#5ab4ac'
                },
                {
                  label: 'Production',
                  data: production,
                  backgroundColor: '#ffffbf'
                },
                {
                  label: 'Importation',
                  data: positiveExchanges,
                  backgroundColor: '#d8b365'
                }
              ];

              var co2Dataset = [
                {
                  label: 'Exportation',
                  data: negativeExchangesCO2Mass,
                  backgroundColor: '#5ab4ac'
                },
                {
                  label: 'Production',
                  data: productionCO2Mass,
                  backgroundColor: '#ffffbf'
                },
                {
                  label: 'Importation',
                  data: positiveExchangesCO2Mass,
                  backgroundColor: '#d8b365'
                }
              ];

              var ctx = document.getElementById('chart');
              chart = new Chart(ctx, {
                type: 'line',
                data: {
                  datasets: isShowingCO2 ? co2Dataset : powerDataset
                },
                options: {
                  animation: false,
                  layout: {
                    padding: 20
                  },
                  scales: {
                    xAxes: [{
                      type: 'time',
                      time: {
                          displayFormats: {
                            hour: 'LT'
                          },
                          tooltipFormat: 'LLLL'
                      }
                    }],
                    yAxes: [{
                      scaleLabel: {
                        display: true,
                        labelString: ''
                      },
                      stacked: true
                    }]
                  },
                  hover: {
                    intersect: false,
                    onHover: handleHover
                  },
                  tooltips: {
                    callbacks: {
                      label: function(d, obj) {
                        return obj.datasets[d.datasetIndex].label + ': ' + d3.format('.1f')(obj.datasets[d.datasetIndex].data[d.index].y) + 
                          (isShowingCO2 ? ' tCO2eq/min' : ' GW');
                      }
                    },
                    intersect: false,
                    itemSort: function(a, b, obj) {
                      return d3.descending(a.datasetIndex, b.datasetIndex);
                    },
                    mode: 'index'
                  },
                }
              })

              drawChart = function() {

                document.getElementById('show-co2').style.color = isShowingCO2 ? 'gray' : 'lightblue';
                document.getElementById('show-co2').style['font-weight'] = isShowingCO2 ? 'bold' : 'normal';
                document.getElementById('show-co2').style.cursor = isShowingCO2 ? 'text' : 'pointer';

                document.getElementById('show-power').style.color = !isShowingCO2 ? 'gray' : 'lightblue';
                document.getElementById('show-power').style['font-weight'] = !isShowingCO2 ? 'bold' : 'normal';
                document.getElementById('show-power').style.cursor = !isShowingCO2 ? 'text' : 'pointer';

                chart.data.datasets = isShowingCO2 ? co2Dataset : powerDataset;
                chart.options.scales.yAxes[0].scaleLabel.labelString = isShowingCO2 ? 'Impact carbone (tCO2/min)' : 'Puissance (GW)';
                chart
                  .update();
                
              };

              drawChart(powerDataset);
              isShowingCO2 = false;

            })

          </script>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      if (window.location.href.indexOf('www.tmrow.co') !== -1) {
        mixpanel.track('Pageview');
        ga('send', 'pageview');
      }
    </script>
  </body>
</html>
